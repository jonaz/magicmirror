<link rel="import" href="/bower_components/polymer/polymer.html">
<link rel="import" href="/bower_components/font-roboto/roboto.html">



<polymer-element name="calendar-widget" attributes="websocketMessage">
	<template>
	<link rel="stylesheet" href="calendar-widget.css">


	<div id="container">
		<div class="date small dimmed">{{time | formatDayName}}, {{time | formatMonth}} {{time |formatDayNumber}} {{time | formatYear}}</div>
		<div class="time">{{time | parseHHMM}}<span class="sec">{{time | parseSS}}</span></div>
		<div class="calendar xxsmall" style="display: block;">
			<table class="calendar-table">
				<tbody>
					<tr style="opacity: 1;">
						<td class="description">{{calendarData[0].summary}}</td>
						<td class="days dimmed">{{calendarData[0].start.dateTime | formatCalendarEventTime}}</td>
					</tr>
					<tr style="opacity: 0.8;">
						<td class="description">{{calendarData[1].summary}}</td>
						<td class="days dimmed">{{calendarData[1].start.dateTime | formatCalendarEventTime}}</td>
					</tr>
					<tr style="opacity: 0.6000000000000001;">
						<td class="description">{{calendarData[2].summary}}</td>
						<td class="days dimmed">{{calendarData[2].start.dateTime | formatCalendarEventTime}}</td>
					</tr>
					<tr style="opacity: 0.4000000000000001;">
						<td class="description">{{calendarData[3].summary}}</td>
						<td class="days dimmed">{{calendarData[3].start.dateTime | formatCalendarEventTime}}</td>
					</tr>
					<tr style="opacity: 0.20000000000000007;">
						<td class="description">{{calendarData[4].summary}}</td>
						<td class="days dimmed">{{calendarData[4].start.dateTime | formatCalendarEventTime}}</td>
					</tr>
					<tr style="opacity: 0.20000000000000007;">
						<td class="description">{{calendarData[5].summary}}</td>
						<td class="days dimmed">{{calendarData[5].start.dateTime | formatCalendarEventTime}}</td>
					</tr>
				</tbody>
			</table>
		</div>
	</div>

  </template>
  <script>

  (function() {

	Polymer('calendar-widget', {
		time: new Date(),
		websocketMessage:{},
		//ready: function(){
			//this.refreshAjax();
		//},
		calendarData: null,
		websocketMessageChanged: function(){
			switch(this.websocketMessage.type){
				case 'calendarEvents':
					this.calendarData = this.websocketMessage.data;
					break;
			}
		},
		formatCalendarEventTime: function(e){
			//2014-08-29T13:00:00+02:00
			moment.locale('sv');
			e = moment(e,"YYYY-MM-DDTHH:mm:ssZ").fromNow();
			return e;
		},
		attached: function() {
			// when we are inserted into DOM, start watching the time
			this.updateTime();
			this.interval = setInterval(this.updateTime.bind(this), 1000);
		},
		detached: function() {
			clearInterval(this.interval);
		},
		updateTime: function() {
			this.time = new Date();
		},
		parseHHMM: function(time){
			return time.getHours()+':'+time.getMinutes();
		},
		parseSS: function(time){
			return time.getSeconds();
		},
		formatDayNumber: function(time){
			return time.getDate();
		},
		formatYear: function(time){
			return time.getFullYear();
		},
		formatDayName: function(time){
			var weekday = new Array(7);
			weekday[0]=  "Söndag";
			weekday[1] = "Måndag";
			weekday[2] = "Tisdag";
			weekday[3] = "Onsdag";
			weekday[4] = "Torsdag";
			weekday[5] = "Fredag";
			weekday[6] = "Lördag";
			return weekday[time.getDay()];
		},
		formatMonth: function(time){
			var month = new Array(12);
			month[0]=  "Januari";
			month[1] = "Februari";
			month[2] = "Mars";
			month[3] = "April";
			month[4] = "Maj";
			month[5] = "Juni";
			month[6] = "Juli";
			month[7] = "Augusti";
			month[8] = "September";
			month[9] = "Oktober";
			month[10] = "November";
			month[11] = "December";
			return month[time.getMonth()];
		}
	});

})();
</script>
</polymer-element>
