<link rel="import" href="/bower_components/core-ajax/core-ajax.html">
<link rel="import" href="/bower_components/polymer/polymer.html">
<link rel="import" href="/bower_components/font-roboto/roboto.html">



<polymer-element name="weather-widget" attributes="websocketMessage">
	<template>
	<link rel="stylesheet" href="weather-widget.css">
	<link rel="stylesheet" href="/bower_components/weather-icons/css/weather-icons.min.css">

	<!--<core-ajax id="ajaxtemp" auto url="/api/temp" handleAs="json" response="{{ajaxMessage}}"></core-ajax>-->
	<!--<core-ajax id="ajaxsunset" auto url="/api/sun/set" handleAs="json" response="{{ajaxMessage}}"></core-ajax>-->


	<div id="container">
		<!--Väder-->
		<!--<i class="wi wi-day-lightning" style="font-size:20px;"></i>-->
		<!--<span id="temp"></span>-->

		<div class="windsun small dimmed" style="display: block;">
			<table>
				<tbody>
					<tr style="opacity: 1;">
						<td><span class="wi wi-strong-wind xdimmed"></span></td>
						<td><span class="wi wi-sunrise xdimmed"></span></td>
						<td><span class="wi wi-sunset xdimmed"></span></td>
					</tr>
					<tr style="opacity: 1;">
						<td><span id="wind">{{weatherData.windmin}}-{{weatherData.windmax}}</span></span></td>
						<td><span id="sunrise"></span></span></td>
						<td><span id="sunset"></span></span></td>
					</tr>
				</tbody>
			</table>
		</div>
		<div class="temp" style="display: block;">
			<span class="icon dimmed wi {{weatherData | formatWeatherIcon}}"></span><span id="temp"></span>°
		</div>
		<div class="forecast small dimmed" style="display: block;">
			<table class="forecast-table">
				<tbody>
					<tr style="opacity: 1;">
						<td class="day">{{weatherData.days[0].day | formatSubstr3}}</td>
						<td><span class="icon-small {{weatherData.days[0] | formatWeatherIcon}}"></span></td>
						<td class="temp-max">{{weatherData.days[0].max}}</td>
						<td class="temp-min">{{weatherData.days[0].min}}</td>
					</tr>
					<tr style="opacity: 0.845;">
						<td class="day">{{weatherData.days[1].day | formatSubstr3}}</td>
						<td><span class="icon-small {{weatherData.days[1] | formatWeatherIcon}}"></span></td>
						<td class="temp-max">{{weatherData.days[1].max}}</td>
						<td class="temp-min">{{weatherData.days[1].min}}</td>
					</tr>
					<tr style="opacity: 0.69;">
						<td class="day">{{weatherData.days[2].day | formatSubstr3}}</td>
						<td><span class="icon-small {{weatherData.days[2] | formatWeatherIcon}}"></span></td>
						<td class="temp-max">{{weatherData.days[2].max}}</td>
						<td class="temp-min">{{weatherData.days[2].min}}</td>
					</tr>
					<tr style="opacity: 0.5349999999999999;">
						<td class="day">{{weatherData.days[3].day | formatSubstr3}}</td>
						<td><span class="icon-small {{weatherData.days[3] | formatWeatherIcon}}"></span></td>
						<td class="temp-max">{{weatherData.days[3].max}}</td>
						<td class="temp-min">{{weatherData.days[3].min}}</td>
					</tr>
					<tr style="opacity: 0.3799999999999999;">
						<td class="day">{{weatherData.days[4].day | formatSubstr3}}</td>
						<td><span class="icon-small {{weatherData.days[4] | formatWeatherIcon}}"></span></td>
						<td class="temp-max">{{weatherData.days[4].max}}</td>
						<td class="temp-min">{{weatherData.days[4].min}}</td>
					</tr>
					<tr style="opacity: 0.2249999999999999;">
						<td class="day">{{weatherData.days[5].day | formatSubstr3}}</td>
						<td><span class="icon-small {{weatherData.days[5] | formatWeatherIcon}}"></span></td>
						<td class="temp-max">{{weatherData.days[5].max}}</td>
						<td class="temp-min">{{weatherData.days[5].min}}</td>
					</tr>
				</tbody>
			</table>
		</div>

	</div>

  </template>
  <script>

  (function() {

	Polymer('weather-widget', {
		selected: 0,
		showmenu: 0,
		page:0,
		websocketMessage:{},
		ready: function(){
			//this.refreshAjax();
		},
		refreshAjax: function(){
			this.$.ajaxtemp.go();
			this.$.ajaxsunset.go();
			this.async(this.refreshAjax,null,900000); //refresh every 15 minutes.
		},
		toggleMenu: function() {
			console.log("toggleMenu");
			if(this.showmenu === 1){
					this.showmenu = 0;
					return;
				}
			this.showmenu = 1;
			console.log(this.showmenu);
		},
		websocketMessageChanged: function(){
			switch(this.websocketMessage.type){
				case 'temp':
					this.$.temp.innerHTML=this.websocketMessage.data;
					break;
				case 'sunset':
					this.$.sunset.innerHTML=this.websocketMessage.data;
					break;
				case 'sunrise':
					this.$.sunrise.innerHTML=this.websocketMessage.data;
					break;
				case 'weather':
					this.weatherData = this.websocketMessage.data;
					break;
				case 'right':
					this.page++
					break;
			}
		},
		formatWeatherIcon:function(data){
			if(data === undefined){
				return;
			}

			console.log(data);

			switch(data.weather){
				case 0: //no Precipitation
					if( data.cloud < 4){
						return 'wi-day-sunny';
					}
					if( data.cloud < 8){
						return 'wi-day-sunny-overcast';
					}
					return 'wi-cloudy';

					break;
				case 1: //snow
				case 2: //snow and rain
					if( data.cloud < 4){
						return 'wi-day-snow';
					}
					return 'wi-snow';
					break;
				case 3: //rain
				case 4: //drizzle
					if( data.cloud < 4){
						return 'wi-day-rain';
					}
					return 'wi-rain';
					break;
				case 5: //freezing rain
				case 6: //freezing drizzle
					return 'wi-snow';
					break;
			}

		},
		formatSubstr3: function(day){
			if(day !== undefined){
				return day.substr(0,3);
			}
			return "";
		}
	});

})();
</script>
</polymer-element>
